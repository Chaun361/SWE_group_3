<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="profile.css"> 
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <nav class="auth-links" id="header-auth-links">
            </nav>
    </header>

    <main class="container">
        <h1 class="page-title">My Account</h1>

        <div class="profile-content-grid">

            <div class="profile-sidebar">
                <nav>
                    <a href="profile.html" class="sidebar-link active">Profile</a>
                    <div class="logout-btn-container">
                        <a href="#" id="logout-link" class="sidebar-link logout-link">Logout</a>
                    </div>
                </nav>
            </div>

            <div class="profile-main">
                <div id="profile-container">
                    <h2>Profile Information</h2>
                    <div class="profile-info-display" id="profile-info-display">
                        <p><strong>Full Name:</strong> <span id="full-name">Loading...</span></p>
                        <p><strong>Username:</strong> <span id="username-display">Loading...</span></p>
                        <p><strong>Phone:</strong> <span id="phone-display">Loading...</span></p>
                        <p><strong>Address:</strong> <span id="address-display">Loading...</span></p>
                    </div>

                    </div>
            </div>

        </div>
    </main>
    
    <script>
        const LOGIN_PAGE = 'login.html';
        // ----------------------------------------------------------------
        // 1. HEADER & LOGIN CHECK (Task 5)
        // ----------------------------------------------------------------
        function updateHeader() {
            const username = sessionStorage.getItem('username');
            const userId = sessionStorage.getItem('userId');
            const isLogin = sessionStorage.getItem('isLogin') === 'true';
            const linksContainer = document.getElementById('header-auth-links');

            linksContainer.innerHTML = ''; 

            if (!isLogin || !username) {
                window.location.href = LOGIN_PAGE; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Login
                return false; 
            }
            
            // Render Logged-in Header
            linksContainer.innerHTML = `
                <a href="index.html" class="nav-link">HOME</a>
                <a href="order-history.html" class="nav-link">Order History</a>
                <a href="profile.html" class="nav-link">${username} üë§</a>
                <a href="cart.html" class="nav-link cart-icon">üõí</a> 
            `;
            return true;
        }

        // ----------------------------------------------------------------
        // 2. FETCH AND RENDER PROFILE DATA (Task 6)
        // ----------------------------------------------------------------
        
        async function fetchAndRenderProfile() {
            try {
                // Hardcoded user ID for testing
                const userId = sessionStorage.getItem('userId');
                const response = await fetch(`http://localhost:8080/api/users/${userId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch profile data: ${response.status}`);
                }

                const data = await response.json();
                // Expected response format:
                // {
                //     "phone": "12346",
                //     "username": "johndoe",
                //     "fullName": "John Doe",
                //     "userId": 1,
                //     "userAddress": "473/47 Thammasat rangsit Pathumthani 10220 Thailand"
                // }

                // Render profile data
                document.getElementById('full-name').textContent = data.fullName;
                document.getElementById('username-display').textContent = data.username;
                document.getElementById('phone-display').textContent = data.phone;
                document.getElementById('address-display').textContent = data.userAddress;

            } catch (error) {
                console.error('Profile Fetch Error:', error);
                const displayContainer = document.getElementById('profile-info-display');
                displayContainer.innerHTML = '<p style="color: red;">Error loading profile data. Please try again later.</p>';
            }
        }
        
       // 3. LOGOUT LOGIC (Task 6:U10 Implementation)
// ----------------------------------------------------------------
function setupLogout() {
     const logoutLink = document.getElementById('logout-link');
     if (logoutLink) {
         logoutLink.addEventListener('click', (e) => {
            e.preventDefault(); 
            
            // 1. ‡∏•‡πâ‡∏≤‡∏á Session Storage ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            sessionStorage.clear(); 
            
            // 2. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Optional)
            alert('Logout successful! Redirecting to Homepage...');
            
            // 3. ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á Homepage (index.html)
            window.location.href = 'index.html';
         });
    }
}
        


        document.addEventListener('DOMContentLoaded', () => {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Login ‡πÅ‡∏•‡∏∞ Render Header
            const loggedIn = updateHeader(); 
            
            if (loggedIn) {
                fetchAndRenderProfile();
            }
            
            setupLogout();
        });
    </script>
</body>
</html>