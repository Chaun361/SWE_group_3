<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <nav class="auth-links" id="header-auth-links">
            </nav>
    </header>

    <main class="container">
    
    <section class="welcome-section" id="welcome-section">
        <h1>Welcome</h1>
        </section>

    <h2 class="products-title">Products</h2> 
    
    <section class="products-grid" id="products-grid">
        </section>

    </main>
<script>
    // ----------------------------------------------------------------
    // 0. CONFIGURATION & MOCK DATA
    // ----------------------------------------------------------------
    const LOGIN_PAGE = 'login.html';
    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á Mock JSON ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ / ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Live Server ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
    const API_PRODUCT_ENDPOINT = 'mock/products.json'; 
    const ADD_TO_CART_MOCK_ENDPOINT = 'mock/add_to_cart.json'; 
    
    const QUANTITY = 1; 

    // Global variable to mock the cart count (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Cart Count ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
    let currentCartCount = 0; 

    // Hardcoded Fallback Data (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà Mock JSON ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
    // ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á JSON ‡πÉ‡∏´‡∏°‡πà: productId, productName, stockQuantity
    const FALLBACK_PRODUCTS = [
        { productId: 1, productName: 'Wireless Mouse', price: 450.0, stockQuantity: 30, imageUrl: '7.jpg' }, 
        { productId: 2, productName: 'Mechanical Keyboard', price: 1250.0, stockQuantity: 20, imageUrl: '2.jpg' },
        { productId: 4, productName: 'Gaming Headset', price: 990.0, stockQuantity: 25, imageUrl: '4.jpg' },
        { productId: 5, productName: 'USB-C Charger 65W', price: 799.0, stockQuantity: 40, imageUrl: '5.jpg' },
        { productId: 6, productName: '27-inch 4K Monitor', price: 8990.0, stockQuantity: 8, imageUrl: '6.jpg' },
        { productId: 7, productName: 'Laptop Stand Adjustable', price: 650.0, stockQuantity: 18, imageUrl: '7.jpg' },
        { productId: 8, productName: 'External SSD 1TB', price: 3290.0, stockQuantity: 12, imageUrl: '8.jpg' },
        { productId: 9, productName: 'Bluetooth Speaker', price: 1150.0, stockQuantity: 22, imageUrl: '9.jpg' },
    ];

    // ----------------------------------------------------------------
    // 1. HEADER & WELCOME SECTION LOGIC (Task 3, T2 - Cart Count)
    // ----------------------------------------------------------------

    function updateHeaderAndWelcome() {
        const username = sessionStorage.getItem('username');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const linksContainer = document.getElementById('header-auth-links');
        const welcomeSection = document.getElementById('welcome-section');
        
        linksContainer.innerHTML = ''; 

        if (isLogin) {
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Cart Count ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Session (‡∏´‡∏£‡∏∑‡∏≠ 0)
            const mockCartCount = sessionStorage.getItem('mockCartCount') || '0';
            currentCartCount = parseInt(mockCartCount);
            
            // Logged In: ‡πÉ‡∏ä‡πâ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå Header ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û 3cc95b.png)
            linksContainer.innerHTML = `
                <a href="index.html" class="nav-link">HOME</a>
                <a href="order-history.html" class="nav-link">order history</a>
                <a href="profile.html" class="nav-link">${username} üë§</a>
                <a href="cart.html" class="nav-link cart-icon">üõí (<span id="cart-count">${mockCartCount}</span>)</a> 
            `;
            
            // Update Welcome Message (‡∏ï‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
            welcomeSection.innerHTML = `
                <h1>Welcome</h1>
                <p>description</p>
            `;

        } else {
            // Logged Out (Login/Register)
            linksContainer.innerHTML = `
                <a href="${LOGIN_PAGE}" class="nav-link">Login</a>
                <a href="register.html" class="nav-link">Register</a>
            `;
            // Update Welcome Message (‡∏ï‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
            welcomeSection.innerHTML = `
                <h1>Welcome</h1>
                <p>description</p>
            `;
        }
    }


    // ----------------------------------------------------------------
    // 2. PRODUCT FETCHING & RENDERING LOGIC (Task 4)
    // ----------------------------------------------------------------

    function renderProducts(products) {
        const gridElement = document.getElementById('products-grid');
        gridElement.innerHTML = ''; 

        products.forEach(product => {
            // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà: productId, productName, stockQuantity
            const cardHtml = `
                <div class="product-card" onclick="window.location.href='product-detail.html?id=${product.productId}'">
                    <div class="product-image">
                        <img src="images/${product.imageUrl || 'placeholder.png'}" alt="${product.productName}">
                    </div>
                    <div class="product-info-grid">
                        <div class="product-text-details">
                            <p class="product-name">productname</p> 
                            <p class="product-price">2000 Baht</p>
                            <p class="product-stock">In stock: x10</p> 
                        </div>
                        <button class="add-to-cart-btn" data-product-id="${product.productId}">Add</button>
                    </div>
                </div>
            `;
            gridElement.innerHTML += cardHtml;
        });
    }

    async function fetchAndDisplayProducts() {
        const gridElement = document.getElementById('products-grid');
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Loading
        gridElement.innerHTML = '<p style="text-align: center; padding: 20px;">Loading products...</p>';

        try {
            // Fetch Mock Data
            const response = await fetch(API_PRODUCT_ENDPOINT);
            
            if (!response.ok) throw new Error('Failed to fetch mock products.');

            const products = await response.json(); 
            renderProducts(products);

        } catch (error) {
            console.error('Product Fetch Error (CORS/Pathing issue). Using Fallback:', error);
            // Fallback Logic: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Mock ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ
            gridElement.innerHTML = '<p style="color: orange; text-align: center; padding: 10px;">Could not fetch mock data. Displaying fallback products.</p>';
            renderProducts(FALLBACK_PRODUCTS); 
        }
    }
    
    // ----------------------------------------------------------------
    // 3. CART COUNT LOGIC (Task 2)
    // ----------------------------------------------------------------
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (Mock Logic)
    async function fetchCartCount() {
        const countElement = document.getElementById('cart-count');
        if (!countElement) return;

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Global Variable ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡πà‡∏≤‡∏ô Add to Cart
        countElement.textContent = currentCartCount.toString(); 
    }

    // ----------------------------------------------------------------
    // 4. ADD TO CART LOGIC (Task 1)
    // ----------------------------------------------------------------

    async function handleAddToCart(button) { // ‡∏£‡∏±‡∏ö Element ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        const userId = sessionStorage.getItem('userId');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';

        if (!isLogin || !userId) {
            alert('Please log in to add items to your cart.');
            window.location.href = LOGIN_PAGE;
            return;
        }

        const productId = button.getAttribute('data-product-id');
        if (!productId) return;

        const requestBody = {
            userId: userId,
            productId: parseInt(productId),
            quantity: QUANTITY
        }; 

        try {
            // Mock API Call
            const response = await fetch(ADD_TO_CART_MOCK_ENDPOINT);
            const data = await response.json();
            
            // --- Mock Logic: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Success/Error ---
            if (data.success) {
                alert(`Product added to cart successfully! (Product ID: ${productId})`); 
                
                // Update Mock Cart Count (Task 2)
                currentCartCount += QUANTITY; 
                sessionStorage.setItem('mockCartCount', currentCartCount.toString()); 
                
                // Update Header Display ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                fetchCartCount(); 

            } else {
                alert(data.message || "An unknown error occurred during add to cart."); 
            }

        } catch (error) {
            alert('Server/Mock connection error. Cannot add item to cart.');
        }
    }

    // Sets up click listeners using Event Delegation 
    function setupAddToCartHandlers() {
        const productsGrid = document.getElementById('products-grid');

        if (productsGrid) {
            productsGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    // **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:** ‡∏™‡πà‡∏á Element ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ
                    e.stopPropagation(); 
                    handleAddToCart(e.target); 
                }
            });
        }
    }


    // ----------------------------------------------------------------
    // 5. INITIALIZATION
    // ----------------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {
        updateHeaderAndWelcome();
        fetchAndDisplayProducts(); 
    });
</script>
</body>
</html>