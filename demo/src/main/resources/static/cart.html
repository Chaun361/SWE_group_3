<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="cart.css"> 
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <a href="index.html" class="index">home</a>
        <nav class="auth-links" id="header-auth-links">
        </nav>
    </header>

     <main class="container">
        <h1 class="page-title">Your Cart</h1>

        <div class="cart-layout">
            
            <div class="cart-items" id="cart-items-container">
                <p class="empty-cart">Loading cart items...</p>
            </div>

            <div class="cart-summary">
                <h2>Order Summary</h2>
                <div class="summary-line">
                    <span>subtotal</span>
                    <span id="summary-subtotal">6000.00 Baht</span>
                </div>
                <div class="summary-line">
                    <span>shipping</span>
                    <span id="summary-shipping">Free</span>
                </div>
                <div class="summary-line total">
                    <span>Total</span>
                    <span id="summary-total">6000.00 Baht</span>
                </div>
                
                <button class="checkout-btn" id="checkout-button">
                    <a href="checkout.html">Checkout</a>
                </button>
            </div>
            
        </div>
    </main>
    
    <script>
    // API Endpoints
    const CART_API_ENDPOINT = 'http://localhost:8080/api/cart/';
    const IMAGE_BASE_URL = "http://localhost:8080/api/images/";
    const CHECKOUT_PAGE = 'checkout.html';
    const LOGIN_PAGE = 'login.html';
    let currentCartData = [];

    // Mock Data - Exactly as shown in the image
    const MOCK_CART_ITEMS = [
        { productId: 1, productName: 'ProductName1', itemPrice: 2000, quantity: 2, itemTotalPrice: 4000, image: 'Core' },
        { productId: 2, productName: 'ProductName2', itemPrice: 2000, quantity: 1, itemTotalPrice: 2000, image: 'PS5' },
        { productId: 3, productName: 'ProductName3', itemPrice: 2000, quantity: 2, itemTotalPrice: 4000, image: 'Device' }
    ];
    const IMAGE_MAP = {
        "1": "1.jpg", 
        "2": "2.jpg", 
        "4": "4.jpg", 
        "5": "5.jpg",
        "6": "6.jpg",
        "7": "7.jpg", 
        "8": "8.jpg",
        "9": "9.jpg"
    };
    // ----------------------------------------------------------------
    // HEADER LOGIC
    // ----------------------------------------------------------------
    function updateHeader() {
        const username = sessionStorage.getItem('username');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const linksContainer = document.getElementById('header-auth-links');
        const savedCartJSON = sessionStorage.getItem('localCartItems');
        let realCartCount = 0;

        if (savedCartJSON) {
            const savedCart = JSON.parse(savedCartJSON);
            // à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¸‚à¸­à¸‡à¸ˆà¸£à¸´à¸‡ (à¸ˆà¸²à¸ quantity à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸°à¸Šà¸´à¹‰à¸™)
            realCartCount = savedCart.reduce((sum, item) => sum + item.quantity, 0);
        }

        if (!isLogin || !username) { 
            // For demo, use mock data
            linksContainer.innerHTML = `
                <a href="#" class="nav-link">home</a>
                <a href="#" class="nav-link">order history</a>
                <a href="#" class="nav-link">customer's name ðŸ‘¤</a>
                <a href="#" class="nav-link">ðŸ›’ (${realCartCount})</a>
            `;
            return true;
        }
        
        linksContainer.innerHTML = `
            <a href="order-history.html" class="nav-link">order history</a>
            <a href="profile.html" class="nav-link">${username} ðŸ‘¤</a>
            <a href="cart.html" class="nav-link">ðŸ›’ (${realCartCount})</a>
        `;
        return true;
    }

    // ----------------------------------------------------------------
    // RENDERING LOGIC
    // ----------------------------------------------------------------
    
    function calculateAndRenderSummary() {
        const summarySubtotal = document.getElementById('summary-subtotal');
        const summaryTotal = document.getElementById('summary-total');
        
        let subtotal = 0;
        const shippingFee = 0.00;
        
        currentCartData.forEach(item => {
            subtotal += item.itemTotalPrice;
        });

        const total = subtotal + shippingFee;
        
        summarySubtotal.textContent = subtotal.toFixed(2) + ' Baht';
        summaryTotal.textContent = total.toFixed(2) + ' Baht';

        document.getElementById('checkout-button').disabled = (subtotal === 0);
    }
    
    function renderCartItems(cartItems) {
    const container = document.getElementById('cart-items-container');
    container.innerHTML = '';
    currentCartData = cartItems;

    if (!cartItems || cartItems.length === 0) {
        container.innerHTML = '<p class="empty-cart">Your cart is empty.</p>';
        document.getElementById('checkout-button').disabled = true;
        document.getElementById('summary-subtotal').textContent = '0.00 Baht';
        document.getElementById('summary-total').textContent = '0.00 Baht';
        return;
    }

    cartItems.forEach((item) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'cart-item';
        itemDiv.innerHTML = `
            <div class="item-img">
                <img src="${IMAGE_BASE_URL + item.image}" alt="${item.productName}">
            </div>
            <div class="item-details">
                <p class="item-name">${item.productName}</p>
                <p class="item-price">${item.itemPrice.toFixed(2)} Baht</p>
            </div>
            <div class="item-actions">
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="decreaseQuantity(${item.productId})">âˆ’</button>
                    <div class="quantity-display" id="qty-${item.productId}">${item.quantity}</div>
                    <button class="quantity-btn" onclick="increaseQuantity(${item.productId})">+</button>
                </div>
                <button class="remove-btn" onclick="removeFromCart(${item.productId})">Remove</button>
            </div>
        `;
        container.appendChild(itemDiv);
    });
    
    calculateAndRenderSummary();
}

    // ----------------------------------------------------------------
    // CART ACTION LOGIC
    // ----------------------------------------------------------------
    
    function saveCartToSession() {
        sessionStorage.setItem('localCartItems', JSON.stringify(currentCartData));
        const newCartCount = currentCartData.reduce((sum, item) => sum + item.quantity, 0);
        sessionStorage.setItem('mockCartCount', newCartCount.toString());
        updateHeader();
    }

    function increaseQuantity(productId) {
        const itemIndex = currentCartData.findIndex(item => item.productId === productId);
        
        if (itemIndex > -1) {
            const item = currentCartData[itemIndex];
            item.quantity += 1;
            item.itemTotalPrice = item.itemPrice * item.quantity;
            
            document.getElementById(`qty-${productId}`).textContent = item.quantity;
            calculateAndRenderSummary();
            saveCartToSession();
        }
    }

    function decreaseQuantity(productId) {
        const itemIndex = currentCartData.findIndex(item => item.productId === productId);
        
        if (itemIndex > -1) {
            const item = currentCartData[itemIndex];
            
            if (item.quantity > 1) {
                item.quantity -= 1;
                item.itemTotalPrice = item.itemPrice * item.quantity;
                
                document.getElementById(`qty-${productId}`).textContent = item.quantity;
                calculateAndRenderSummary();
                saveCartToSession();
            }
        }
    }

    // ----------------------------------------------------------------
    // DATA FETCHING
    // ----------------------------------------------------------------
    async function fetchAndRenderCart() {
        const userId = sessionStorage.getItem('userId');
        
        // à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Session Storage à¸à¹ˆà¸­à¸™
        const savedCart = sessionStorage.getItem('localCartItems');

        if (savedCart) {
            console.log('Loading cart from Session Storage');
            renderCartItems(JSON.parse(savedCart));
            return; 
        }
        
        console.log('No session data, using MOCK_CART_ITEMS');
        renderCartItems(MOCK_CART_ITEMS);
        saveCartToSession(); 
    }

    // ----------------------------------------------------------------
    // CART ITEM REMOVAL
    // ----------------------------------------------------------------
    async function removeFromCart(productId) {
        if (confirm('Are you sure you want to remove this item?')) {
            const itemIndex = currentCartData.findIndex(item => item.productId === productId);
            
            if (itemIndex > -1) {
                currentCartData.splice(itemIndex, 1);
                renderCartItems(currentCartData);
                saveCartToSession();
            }
        }
    }
    
    // ----------------------------------------------------------------
    // INITIALIZATION
    // ----------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        updateHeader();
        fetchAndRenderCart();
    });
    </script>
</body>
</html>