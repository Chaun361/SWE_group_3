<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="cart.css"> 
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <a href="index.html" class="index">home</a>
        <nav class="auth-links" id="header-auth-links">
        </nav>
    </header>

     <main class="container">
        <h1 class="page-title">Your Cart</h1>

        <div class="cart-layout">

            <div class="cart-items" id="cart-items-container">
                <p class="empty-cart">Loading cart items...</p>
            </div>

            <div class="cart-summary">
                <h2>Order Summary</h2>
                <div class="summary-line">
                    <span>subtotal</span>
                    <span id="summary-subtotal">6000.00 Baht</span>
                </div>
                <div class="summary-line">
                    <span>shipping</span>
                    <span id="summary-shipping">Free</span>
                </div>
                <div class="summary-line total">
                    <span>Total</span>
                    <span id="summary-total">6000.00 Baht</span>
                </div>

                <button class="checkout-btn" id="checkout-button">
                    <a href="checkout.html">Checkout</a>
                </button>
            </div>

        </div>
    </main>

    <script>
    // API Endpoints
Â  Â  const CART_API_ENDPOINT = 'http://localhost:8080/api/cart/';
Â  Â  const IMAGE_BASE_URL = "http://localhost:8080/api/images/";
Â  Â  const CHECKOUT_PAGE = 'checkout.html';
Â  Â  const LOGIN_PAGE = 'login.html';
Â  Â  let currentCartData = [];

Â  Â  // Mock Data
Â  Â  const MOCK_CART_ITEMS = [
Â  Â  Â  Â  { productId: 1, name: 'ProductName1', price: 2000, quantity: 2, subtotal: 4000, image: 'Core' },
Â  Â  Â  Â  { productId: 2, name: 'ProductName2', price: 2000, quantity: 1, subtotal: 2000, image: 'PS5' },
Â  Â  Â  Â  { productId: 3, name: 'ProductName3', price: 2000, quantity: 2, subtotal: 4000, image: 'Device' }
Â  Â  ];
    // à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¸œà¸¡à¹à¸à¹‰ MOCK_CART_ITEMS à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰ 'name', 'price', 'subtotal'
    // à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸¡à¸±à¸™à¸•à¸£à¸‡à¸à¸±à¸šà¸¡à¸²à¸•à¸£à¸à¸²à¸™à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¸„à¸¸à¸“à¹€à¸¥à¸·à¸­à¸ (à¹‚à¸„à¹‰à¸”à¸ˆà¸°à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸à¸±à¸‡à¸•à¸­à¸™ test)

Â  Â  // ----------------------------------------------------------------
Â  Â  // HEADER LOGIC
Â  Â  // ----------------------------------------------------------------
Â  Â  function updateHeader() {
Â  Â  Â  Â  const username = sessionStorage.getItem('username');
Â  Â  Â  Â  const isLogin = sessionStorage.getItem('isLogin') === 'true';
Â  Â  Â  Â  const linksContainer = document.getElementById('header-auth-links');
Â  Â  Â  Â  
Â  Â  Â  Â  // FIX: à¹ƒà¸Šà¹‰ logic à¹€à¸”à¸µà¸¢à¸§à¹ƒà¸™à¸à¸²à¸£à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¸•à¸°à¸à¸£à¹‰à¸²
Â  Â  Â  Â  const savedCartJSON = sessionStorage.getItem('localCartItems');
Â  Â  Â  Â  let realCartCount = 0;
Â  Â  Â  Â  if (savedCartJSON) {
Â  Â  Â  Â  Â  Â  const savedCart = JSON.parse(savedCartJSON);
Â  Â  Â  Â  Â  Â  realCartCount = savedCart.reduce((sum, item) => sum + item.quantity, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!isLogin || !username) { 
Â  Â  Â  Â  Â  Â  linksContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="nav-link">home</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="nav-link">order history</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="nav-link">customer's name ğŸ‘¤</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="nav-link">ğŸ›’ (${realCartCount})</a>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // FIX: à¸¥à¸šà¸•à¸°à¸à¸£à¹‰à¸²à¸—à¸µà¹ˆà¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™à¸­à¸­à¸
Â  Â  Â  Â  Â  Â  linksContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <a href="order-history.html" class="nav-link">order history</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="profile.html" class="nav-link">${username} ğŸ‘¤</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="cart.html" class="nav-link">ğŸ›’ (${realCartCount})</a>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â  return true;
Â  Â  }

Â  Â  // ----------------------------------------------------------------
Â  Â  // RENDERING LOGIC
Â  Â  // ----------------------------------------------------------------

Â  Â  function calculateAndRenderSummary() {
Â  Â  Â  Â  const summarySubtotal = document.getElementById('summary-subtotal');
Â  Â  Â  Â  const summaryTotal = document.getElementById('summary-total');
Â  Â  Â  Â  let subtotal = 0;
Â  Â  Â  Â  const shippingFee = 0.00;

Â  Â  Â  Â  currentCartData.forEach(item => {
Â  Â  Â  Â  Â  Â  // à¹ƒà¸Šà¹‰ 'subtotal' à¸—à¸µà¹ˆà¹€à¸£à¸²à¸•à¸à¸¥à¸‡à¸à¸±à¸™à¹„à¸§à¹‰
Â  Â  Â  Â  Â  Â  subtotal += (item.subtotal || 0); 
Â  Â  Â  Â  });

Â  Â  Â  Â  const total = subtotal + shippingFee;
Â  Â  Â  Â  const formatOptions = {
Â  Â  Â  Â  Â  Â  style: 'decimal',
Â  Â  Â  Â  Â  Â  minimumFractionDigits: 2,
Â  Â  Â  Â  Â  Â  maximumFractionDigits: 2
Â  Â  Â  Â  };
Â  Â  Â  Â  summarySubtotal.textContent = subtotal.toLocaleString('en-US', formatOptions) + ' Baht';
Â  Â  Â  Â  summaryTotal.textContent = total.toLocaleString('en-US', formatOptions) + ' Baht';
Â  Â  Â  Â  document.getElementById('checkout-button').disabled = (subtotal === 0);
Â  Â  }
Â  Â  
Â  Â  function renderCartItems(cartItems) {
Â  Â  Â  Â  const container = document.getElementById('cart-items-container');
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  currentCartData = cartItems;

Â  Â  Â  Â  if (!cartItems || cartItems.length === 0) {
Â  Â  Â  Â  Â  Â  container.innerHTML = '<p class="empty-cart">Your cart is empty.</p>';
Â  Â  Â  Â  Â  Â  calculateAndRenderSummary(); // à¸„à¸³à¸™à¸§à¸“à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ 0
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  cartItems.forEach((item) => {
Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  itemDiv.className = 'cart-item';
Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-img">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${IMAGE_BASE_URL + (item.image || 'placeholder.png')}" alt="${item.name}">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="item-name">${item.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="item-price">${item.price.toLocaleString('en-US', { minimumFractionDigits: 2 })} Baht</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="quantity-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="quantity-btn" onclick="decreaseQuantity(${item.productId})">âˆ’</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="quantity-display" id="qty-${item.productId}">${item.quantity}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="quantity-btn" onclick="increaseQuantity(${item.productId})">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="remove-btn" onclick="removeFromCart(${item.productId})">Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(itemDiv);
Â  Â  Â  Â  });
Â  Â  Â  Â  calculateAndRenderSummary();
Â  Â  }

Â  Â  // ----------------------------------------------------------------
Â  Â  // CART ACTION LOGIC
Â  Â  // ----------------------------------------------------------------
Â  Â  function saveCartToSession() {
Â  Â  Â  Â  sessionStorage.setItem('localCartItems', JSON.stringify(currentCartData));
Â  Â  Â  Â  const newCartCount = currentCartData.reduce((sum, item) => sum + item.quantity, 0);
Â  Â  Â  Â  sessionStorage.setItem('mockCartCount', newCartCount.toString()); // (à¸•à¸±à¸§à¹à¸›à¸£à¸™à¸µà¹‰à¸­à¸²à¸ˆà¹„à¸¡à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¹à¸¥à¹‰à¸§ à¹à¸•à¹ˆà¹€à¸à¹‡à¸šà¹„à¸§à¹‰à¹€à¸œà¸·à¹ˆà¸­)
Â  Â  Â  Â  updateHeader(); // à¸­à¸±à¸›à¹€à¸”à¸• Header à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸‹à¸Ÿ
Â  Â  }

Â  Â  function increaseQuantity(productId) {
Â  Â  Â  Â  const itemIndex = currentCartData.findIndex(item => item.productId === productId);
Â  Â  Â  Â  if (itemIndex > -1) {
Â  Â  Â  Â  Â  Â  const item = currentCartData[itemIndex];
Â  Â  Â  Â  Â  Â  item.quantity += 1;
Â  Â  Â  Â  Â  Â  item.subtotal = item.price * item.quantity; 
Â  Â  Â  Â  Â  Â  document.getElementById(`qty-${productId}`).textContent = item.quantity;
Â  Â  Â  Â  Â  Â  calculateAndRenderSummary();
Â  Â  Â  Â  Â  Â  saveCartToSession();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function decreaseQuantity(productId) {
Â  Â  Â  Â  const itemIndex = currentCartData.findIndex(item => item.productId === productId);
Â  Â  Â  Â  if (itemIndex > -1) {
Â  Â  Â  Â  Â  Â  const item = currentCartData[itemIndex];
Â  Â  Â  Â  Â  Â  if (item.quantity > 1) {
Â  Â  Â  Â  Â  Â  Â  Â  item.quantity -= 1;
Â  Â  Â  Â  Â  Â  Â  Â  item.subtotal = item.price * item.quantity;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`qty-${productId}`).textContent = item.quantity;
Â  Â  Â  Â  Â  Â  Â  Â  calculateAndRenderSummary();
Â  Â  Â  Â  Â  Â  Â  Â  saveCartToSession();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ----------------------------------------------------------------
Â  Â  // DATA FETCHING
Â  Â  // ----------------------------------------------------------------
Â  Â  
Â  Â  // FIX: à¸¡à¸µà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸”à¸µà¸¢à¸§à¸—à¸µà¹ˆà¸£à¸§à¸¡ Logic à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
Â  Â  async function fetchAndRenderCart() {
Â  Â  Â  Â  // 1. à¸¥à¸­à¸‡à¸”à¸¶à¸‡à¸ˆà¸²à¸ Session Storage à¸à¹ˆà¸­à¸™
Â  Â  Â  Â  const savedCart = sessionStorage.getItem('localCartItems');
Â  Â  Â  Â  if (savedCart) {
Â  Â  Â  Â  Â  Â  console.log('Loading cart from Session Storage');
Â  Â  Â  Â  Â  Â  renderCartItems(JSON.parse(savedCart));
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ, à¸¥à¸­à¸‡à¸¢à¸´à¸‡ API (à¸–à¹‰à¸²à¸¡à¸µ userId)
Â  Â  Â  Â  const userId = sessionStorage.getItem('userId');
Â  Â  Â  Â  if (userId) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('No session data, fetching from API...');
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(CART_API_ENDPOINT + userId);
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Failed to fetch cart data: ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const cartData = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (!cartData || !cartData.items || cartData.items.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCartItems([]); // à¸•à¸°à¸à¸£à¹‰à¸²à¸§à¹ˆà¸²à¸‡
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCartItems(cartData.items);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveCartToSession(); // à¹€à¸‹à¸Ÿà¸‚à¸­à¸‡à¸ˆà¸£à¸´à¸‡à¸¥à¸‡ Session
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return; // à¸ˆà¸š
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Cart Load Error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  // à¸–à¹‰à¸² API à¸¥à¹ˆà¸¡, à¹ƒà¸«à¹‰à¹„à¸›à¹ƒà¸Šà¹‰ Mock data à¸‚à¹‰à¸²à¸‡à¸¥à¹ˆà¸²à¸‡
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. à¸—à¸²à¸‡à¹€à¸¥à¸·à¸­à¸à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ (à¹„à¸¡à¹ˆà¸¡à¸µ userId à¸«à¸£à¸·à¸­ API à¸¥à¹ˆà¸¡)
Â  Â  Â  Â  console.log('No session data or API failed, using MOCK_CART_ITEMS');
Â  Â  Â  Â  renderCartItems(MOCK_CART_ITEMS);
Â  Â  Â  Â  saveCartToSession(); 
Â  Â  }

Â  Â  // ----------------------------------------------------------------
Â  Â  // CART ITEM REMOVAL
Â  Â  // ----------------------------------------------------------------
Â  Â  async function removeFromCart(productId) {
Â  Â  Â  Â  if (confirm('Are you sure you want to remove this item?')) {
Â  Â  Â  Â  Â  Â  const itemIndex = currentCartData.findIndex(item => item.productId === productId);
Â  Â  Â  Â  Â  Â  if (itemIndex > -1) {
Â  Â  Â  Â  Â  Â  Â  Â  currentCartData.splice(itemIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  renderCartItems(currentCartData);
Â  Â  Â  Â  Â  Â  Â  Â  saveCartToSession();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  // ----------------------------------------------------------------
Â  Â  // INITIALIZATION
Â  Â  // ----------------------------------------------------------------
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  updateHeader();
Â  Â  Â  Â  fetchAndRenderCart();
Â  Â  });
    </script>
</body>
</html>