<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="cart.css"> 
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <nav class="auth-links" id="header-auth-links">
        </nav>
    </header>

    <main class="container">
        <h1 class="page-title">Your Cart</h1>

        <div class="cart-layout">
            
            <div class="cart-items" id="cart-items-container">
                <p style="text-align: center;">Loading cart items...</p>
            </div>

            <div class="cart-summary">
                <h2>Order Summary</h2>
                <div class="summary-line">
                    <span>Subtotal</span>
                    <span id="summary-subtotal">0 ‡∏ø</span>
                </div>
                <div class="summary-line">
                    <span>Shipping</span>
                    <span id="summary-shipping">Free</span>
                </div>
                <div class="summary-line total">
                    <span>Total Price</span>
                    <span id="summary-total">0 ‡∏ø</span>
                </div>
                
                <button class="submit-btn checkout-btn" onclick="window.location.href='checkout.html'">Checkout</button>
            </div>
            
        </div>
    </main>
    
    <script>
    // ----------------------------------------------------------------
    // 0. CONFIGURATION & MOCK DATA
    // ----------------------------------------------------------------
    const LOGIN_PAGE = 'login.html';
    const CHECKOUT_PAGE = 'checkout.html';
    const MOCK_CART_ENDPOINT = 'mock/cart.json'; // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ fetch()
    
    // Hardcoded Mock Data (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Render ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á, ‡∏°‡∏µ Subtotal/Price ‡∏Ñ‡∏£‡∏ö)
    let MOCK_CART_ITEMS = [
        { id: 501, productId: 103, name: "Gaming Laptop", price: 35990, quantity: 1, subtotal: 35990 },
        { id: 502, productId: 101, name: "Wireless Headphones", price: 2990, quantity: 2, subtotal: 5980 },
        { id: 503, productId: 104, name: "Gaming Console", price: 18900, quantity: 1, subtotal: 18900 }
    ];

    // ----------------------------------------------------------------
    // 1. HEADER LOGIC (Task 5)
    // ----------------------------------------------------------------
    function updateHeader() {
        const username = sessionStorage.getItem('username');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const linksContainer = document.getElementById('header-auth-links');
        const mockCartCount = sessionStorage.getItem('mockCartCount') || '0';

        if (!isLogin || !username) { 
            window.location.href = LOGIN_PAGE; 
            return false; 
        }
        
        linksContainer.innerHTML = `
            <a href="index.html" class="nav-link">HOME</a>
            <a href="order-history.html" class="nav-link">Order History</a>
            <a href="profile.html" class="nav-link">${username} üë§</a>
            <a href="cart.html" class="nav-link cart-icon">üõí (${mockCartCount})</a> 
        `;
        return true;
    }

    // ----------------------------------------------------------------
    // 2. RENDERING LOGIC & RECALCULATION
    // ----------------------------------------------------------------
    
    // Helper: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Summary Section
    function calculateAndRenderSummary() {
        const summarySubtotal = document.getElementById('summary-subtotal');
        const summaryTotal = document.getElementById('summary-total');
        
        let subtotal = 0;
        const shippingFee = 0.00; 
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å MOCK_CART_ITEMS Global Array ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
        MOCK_CART_ITEMS.forEach(item => {
            subtotal += item.subtotal;
        });

        const total = subtotal + shippingFee;
        
        summarySubtotal.textContent = subtotal.toLocaleString() + ' ‡∏ø';
        summaryTotal.textContent = total.toLocaleString() + ' ‡∏ø';

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏° Checkout
        document.querySelector('.checkout-btn').disabled = (subtotal === 0);
    }
    
    function renderCartItems(cartItems) {
        const container = document.getElementById('cart-items-container');
        container.innerHTML = '';
        MOCK_CART_ITEMS = cartItems; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Global Mock Data

        if (!cartItems || cartItems.length === 0) {
            container.innerHTML = '<p style="text-align: center; padding: 20px;">Your cart is empty.</p>';
            calculateAndRenderSummary();
            return;
        }

        cartItems.forEach(item => {
            const itemTotal = item.price * item.quantity; // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
            
            const itemHtml = `
                <div class="cart-item">
                    <div class="item-img"></div>
                    <div class="item-details">
                        <p class="item-name">${item.name}</p>
                        <p class="item-price">${item.price.toLocaleString()} ‡∏ø / unit</p>
                    </div>
                    <div class="item-quantity">
                        <input 
                            type="number" 
                            value="${item.quantity}" 
                            min="1" 
                            data-product-id="${item.productId}" 
                            onchange="updateQuantity(this)"
                        > 
                    </div>
                    <div class="item-subtotal" id="subtotal-${item.productId}">
                        ${itemTotal.toLocaleString()} ‡∏ø
                    </div>
                    <button class="item-remove" onclick="removeItem('${item.productId}')">&times;</button>
                </div>
            `;
            container.innerHTML += itemHtml;
        });
        
        calculateAndRenderSummary();
    }

    // ----------------------------------------------------------------
    // 3. CART ACTION LOGIC (Client-side Recalculation)
    // ----------------------------------------------------------------
    
    // NEW LOGIC: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Subtotal ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
    function updateQuantity(inputElement) {
        const productId = parseInt(inputElement.getAttribute('data-product-id'));
        const newQuantity = parseInt(inputElement.value);
        
        if (newQuantity < 1) {
            alert("Quantity must be at least 1.");
            inputElement.value = 1; 
            return;
        }

        const itemIndex = MOCK_CART_ITEMS.findIndex(item => item.productId === productId);
        
        if (itemIndex > -1) {
            const item = MOCK_CART_ITEMS[itemIndex];
            
            // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Quantity ‡πÅ‡∏•‡∏∞ Subtotal ‡πÉ‡∏ô Mock Array
            item.quantity = newQuantity;
            item.subtotal = item.price * newQuantity; 
            
            // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Subtotal ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            document.getElementById(`subtotal-${productId}`).textContent = item.subtotal.toLocaleString() + ' ‡∏ø';
            
            // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡∏°‡πà
            calculateAndRenderSummary(); 

            alert(`Mock API: Quantity updated locally. Total recalculated.`);
        }
    }

    // NEW LOGIC: ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    function removeItem(productIdStr) {
        const productId = parseInt(productIdStr);
        if (confirm(`Are you sure you want to remove Product ${productId}? (Mock)`)) {
            
            // 1. ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Mock Array
            MOCK_CART_ITEMS = MOCK_CART_ITEMS.filter(item => item.productId !== productId);
            
            // 2. Rerender ‡∏ó‡∏±‡πâ‡∏á Cart ‡πÅ‡∏•‡∏∞ Summary
            renderCartItems(MOCK_CART_ITEMS); 

            alert(`Mock API: Item ${productId} removed. Cart updated.`);
        }
    }


    // ----------------------------------------------------------------
    // 4. DATA FETCHING (Using Mock Data)
    // ----------------------------------------------------------------
    async function fetchAndRenderCart() {
        const userId = sessionStorage.getItem('userId');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const container = document.getElementById('cart-items-container');

        if (!isLogin || !userId) {
            window.location.href = LOGIN_PAGE; 
            return;
        }

        // Logic Mock 404/204
        if (userId === '999') { renderCartItems([]); return; }
        if (userId === '000') { 
            container.innerHTML = '<p style="color: red; text-align: center; padding: 20px;">Error 404: Cart not found for this user.</p>';
            return;
        }
        
        // Scenario 3: ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÉ‡∏ä‡πâ MOCK_DATA_TO_RENDER)
        renderCartItems(MOCK_CART_ITEMS); 
    }

    // ----------------------------------------------------------------
    // 5. INITIALIZATION
    // ----------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        const loggedIn = updateHeader();
        if (loggedIn) {
            fetchAndRenderCart();
        }
    });
</script>
</body>
</html>