<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | WEBSITE NAME</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="cart.css"> 
</head>
<body>

    <header class="main-header">
        <div class="logo">WEBSITE NAME</div>
        <nav class="auth-links" id="header-auth-links">
            </nav>
    </header>

    <main class="container">
        <h1 class="page-title">Your Cart</h1>

        <div class="cart-layout">
            
            <div class="cart-items" id="cart-items-container">
                <p style="text-align: center;">Loading cart items...</p>
                </div>

            <div class="cart-summary">
                <h2>Order Summary</h2>
                <div class="summary-line">
                    <span>Subtotal</span>
                    <span id="summary-subtotal">0 ‡∏ø</span>
                </div>
                <div class="summary-line">
                    <span>Shipping</span>
                    <span id="summary-shipping">Free</span>
                </div>
                <div class="summary-line total">
                    <span>Total Price</span>
                    <span id="summary-total">0 ‡∏ø</span>
                </div>
                
                <button class="submit-btn checkout-btn" onclick="window.location.href='checkout.html'">Checkout</button>
            </div>
            
        </div>
    </main>
    
    <script>
    // API Endpoint ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ Mock JSON
    const MOCK_CART_ENDPOINT = '/mock/cart.json'; 
    const CHECKOUT_PAGE = 'checkout.html';
    const LOGIN_PAGE = 'login.html';

    // ----------------------------------------------------------------
    // 1. HEADER LOGIC (Unchanged)
    // ----------------------------------------------------------------
    function updateHeader() {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î updateHeader ‡πÄ‡∏î‡∏¥‡∏°) ...
        const username = sessionStorage.getItem('username');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const linksContainer = document.getElementById('header-auth-links');

        linksContainer.innerHTML = ''; 

        if (isLogin) {
            linksContainer.innerHTML = `
                <a href="index.html" class="nav-link">HOME</a>
                <a href="order-history.html" class="nav-link">Order History</a>
                <a href="profile.html" class="nav-link">${username} üë§</a>
                <a href="cart.html" class="nav-link cart-icon">üõí</a> 
            `;
        } else {
            linksContainer.innerHTML = `
                <a href="${LOGIN_PAGE}" class="nav-link">Login</a>
                <a href="register.html" class="nav-link">Register</a>
            `;
        }
    }

    // ----------------------------------------------------------------
    // 2. PRODUCT RENDERING AND CALCULATION LOGIC (Unchanged)
    // ----------------------------------------------------------------
    
    function renderCartItems(cartItems) {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î renderCartItems ‡πÄ‡∏î‡∏¥‡∏°) ...
        const container = document.getElementById('cart-items-container');
        let subtotal = 0;
        container.innerHTML = '';

        if (!cartItems || cartItems.length === 0) {
            container.innerHTML = '<p style="text-align: center; padding: 20px;">Your cart is empty.</p>';
            // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Checkout
            document.querySelector('.checkout-btn').disabled = true;
            document.getElementById('summary-subtotal').textContent = '0 ‡∏ø';
            document.getElementById('summary-total').textContent = '0 ‡∏ø';
            return;
        }

        document.querySelector('.checkout-btn').disabled = false;

        cartItems.forEach(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            
            const itemHtml = `
                <div class="cart-item">
                    <div class="item-img"></div>
                    <div class="item-details">
                        <p class="item-name">${item.name}</p>
                        <p class="item-price">${item.price.toLocaleString()} ‡∏ø / unit</p>
                    </div>
                    <div class="item-quantity">
                        <input type="number" value="${item.quantity}" min="1" disabled>
                    </div>
                    <div class="item-subtotal">
                        ${itemTotal.toLocaleString()} ‡∏ø
                    </div>
                    <button class="item-remove" onclick="alert('Item ${item.id} removed (Mock)')">&times;</button>
                </div>
            `;
            container.innerHTML += itemHtml;
        });
        
        document.getElementById('summary-subtotal').textContent = subtotal.toLocaleString() + ' ‡∏ø';
        document.getElementById('summary-total').textContent = subtotal.toLocaleString() + ' ‡∏ø';
    }


    // ----------------------------------------------------------------
    // 3. DATA FETCHING (Mock Logic - Revised for Task 6)
    // ----------------------------------------------------------------
    async function fetchAndRenderCart() {
        const userId = sessionStorage.getItem('userId');
        const isLogin = sessionStorage.getItem('isLogin') === 'true';
        const container = document.getElementById('cart-items-container');

        if (!isLogin || !userId) {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login
            alert('Please log in to view your cart.');
            window.location.href = LOGIN_PAGE; 
            return;
        }

        try {
            // **Mock Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 204 ‡πÅ‡∏•‡∏∞ 404**
            // ‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á API ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ response status
            // ‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ Mock JSON file ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç userId
            
            // Scenario 1: ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á (Mock 204)
            if (userId === '999') { 
                 renderCartItems([]); // ‡∏™‡πà‡∏á array ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏õ render
                 return;
            }

            // Scenario 2: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (Mock 404)
            if (userId === '000') {
                 container.innerHTML = '<p style="color: red; text-align: center; padding: 20px;">Error 404: Cart not found for this user.</p>';
                 return;
            }

            // Scenario 3: ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Mock 200) - ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å MOCK_CART_ENDPOINT
            const response = await fetch(MOCK_CART_ENDPOINT); 
            
            if (!response.ok) {
                // ‡∏´‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Mock ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á Error
                throw new Error(`Failed to fetch cart data: ${response.status}`);
            }

            const cartData = await response.json(); 
            
            renderCartItems(cartData); 

        } catch (error) {
            console.error('Cart Load Error:', error);
            container.innerHTML = 
                '<p style="color: red; text-align: center; padding: 20px;">Could not load cart data. Please check Mock file/Server.</p>';
        }
    }

    // ----------------------------------------------------------------
    // 4. INITIALIZATION
    // ----------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        updateHeader();
        fetchAndRenderCart();
    });
</script>
</body>
</html>