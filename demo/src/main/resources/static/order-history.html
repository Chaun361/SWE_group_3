<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order History</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="order-history.css" />
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <h2 class="logo">WEBSITE NAME</h2>
    </div>
    <div class="nav-right">
      <a href="index.html">home</a>
      <a href="order-history.html" class="active">order history</a>
      <a href="profile.html">customerâ€™s name</a>
      <span class="user-icon">ðŸ‘¤</span>
      <span class="cart-icon">ðŸ›’</span>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">Order history</h1>
    <div id="order-list" class="order-list">Loading...</div>
  </main>
  <script>
    async function loadOrderHistory(userId) {
      try {
        const response = await fetch("http://localhost:8080/api/orders/history/" + userId);
      if (!response.ok) throw new Error("Failed to fetch order history");

      const orders = await response.json();
      const container = document.getElementById('order-list');
      container.innerHTML = '';

      if (!orders.length) {
      container.innerHTML = '<p>No order history found.</p>';
      return;
    }

    orders.forEach(order => {
      const total = order.orderItems?.reduce(
        (sum, item) => sum + item.pricePerUnit * item.quantity, 0
      ) || 0;

      const div = document.createElement('div');
      div.className = 'order-card';
      div.innerHTML = `
        <div class="order-header">
          <div class="order-left">
            <img src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png" class="order-icon">
            <div>
              <h3>Order #${order.orderId}</h3>
              <p class="order-date">ðŸ“… ${order.orderDate.split('T')[0]}</p>
            </div>
          </div>
          <span class="order-status ${order.status.toLowerCase()}">${order.status}</span>
        </div>

        <div class="order-body">
          ${order.orderItems.map(i => `
            <div class="item-row">
              <div class="item-left">
                <p>${i.productName}</p>
                <small>${(i.pricePerUnit).toLocaleString()} Baht x${i.quantity}</small>
              </div>
              <div class="item-right">
                <strong>${(i.pricePerUnit * i.quantity).toLocaleString()} Baht</strong>
              </div>
            </div>
          `).join('')}
        </div>

        <div class="order-footer">
          <hr>
          <p class="order-total"><strong>Total:</strong> ${total.toLocaleString()} Baht</p>
        </div>
      `;
      container.appendChild(div);
    });
    } catch (err) {
      console.error(err);
      document.getElementById('order-list').innerHTML = '<p>Cannot load order history.</p>';
    }
  }

    document.addEventListener('DOMContentLoaded', () => {
      const userId = 1; // à¸ªà¸¡à¸¡à¸¸à¸•à¸´ user id = 1
      loadOrderHistory(userId);
    });
  </script>
</body>
</html>
